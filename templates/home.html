{% extends 'base.html' %}

{% block title %}–†–µ–π—Ç–∏–Ω–≥ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π{% endblock %}

{% block content %}
    <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</h1>

    <!-- üîç –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
    <input type="text" id="search-input" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è..." autocomplete="off">
    <div id="search-results" class="list-group mt-2" style="max-height: 200px; overflow-y: auto; display: none;"></div>

    <!-- üìä –ö–Ω–æ–ø–∫–∞ "–†–µ–π—Ç–∏–Ω–≥ –∫–∞—Ñ–µ–¥—Ä" -->
    <a href="{% url 'department_ranking' %}" class="btn btn-primary mt-3">üìä –†–µ–π—Ç–∏–Ω–≥ –∫–∞—Ñ–µ–¥—Ä</a>

    <div class="row mt-4">
        <!-- üèÜ –¢–∞–±–ª–∏—Ü–∞ 1: –¢–û–ü-5 –ø–æ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º—É -->
        <div class="col-md-4">
            <h3 class="text-center">üèÜ –¢–û–ü-5 –ø–æ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º—É</h3>
            <table class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>–§–æ—Ç–æ</th>
                        <th>–§–ò–û</th>
                        <th>–†–µ–π—Ç–∏–Ω–≥</th>
                    </tr>
                </thead>
                <tbody>
                    {% for professor in top_professionalism %}
                    <tr>
                        <td>
                            <img src="{{ professor.photo.url }}" width="50" onerror="this.src='/static/default_photo.jpg'">
                        </td>
                        <td><a href="{% url 'professor_detail' professor.id %}">{{ professor.name }}</a></td>
                        <td>{{ professor.avg_professionalism|floatformat:1 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- üèÜ –¢–∞–±–ª–∏—Ü–∞ 2: –¢–û–ü-5 –ø–æ –Ø—Å–Ω–æ—Å—Ç–∏ -->
        <div class="col-md-4">
            <h3 class="text-center">üèÜ –¢–û–ü-5 –ø–æ –Ø—Å–Ω–æ—Å—Ç–∏</h3>
            <table class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>–§–æ—Ç–æ</th>
                        <th>–§–ò–û</th>
                        <th>–†–µ–π—Ç–∏–Ω–≥</th>
                    </tr>
                </thead>
                <tbody>
                    {% for professor in top_clarity %}
                    <tr>
                        <td>
                            <img src="{{ professor.photo.url }}" width="50" onerror="this.src='/static/default_photo.jpg'">
                        </td>
                        <td><a href="{% url 'professor_detail' professor.id %}">{{ professor.name }}</a></td>
                        <td>{{ professor.avg_clarity|floatformat:1 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- üèÜ –¢–∞–±–ª–∏—Ü–∞ 3: –¢–û–ü-5 –ø–æ –û—Ç–Ω–æ—à–µ–Ω–∏—é -->
        <div class="col-md-4">
            <h3 class="text-center">üèÜ –¢–û–ü-5 –ø–æ –û—Ç–Ω–æ—à–µ–Ω–∏—é</h3>
            <table class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>–§–æ—Ç–æ</th>
                        <th>–§–ò–û</th>
                        <th>–†–µ–π—Ç–∏–Ω–≥</th>
                    </tr>
                </thead>
                <tbody>
                    {% for professor in top_attitude %}
                    <tr>
                        <td>
                            <img src="{{ professor.photo.url }}" width="50" onerror="this.src='/static/default_photo.jpg'">
                        </td>
                        <td><a href="{% url 'professor_detail' professor.id %}">{{ professor.name }}</a></td>
                        <td>{{ professor.avg_attitude|floatformat:1 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ‚úÖ JavaScript –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchInput = document.getElementById("search-input");
            const searchResults = document.getElementById("search-results");

            searchInput.addEventListener("input", function() {
                const query = searchInput.value.trim(); // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã

                if (query.length === 0) {
                    searchResults.style.display = "none";
                    return;
                }

                console.log("üîç –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: /autocomplete/?q=" + query);

                fetch(`/autocomplete/?q=${query}`)
                    .then(response => {
                        console.log("üì© –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω", response);
                        return response.json();
                    })
                    .then(data => {
                        console.log("üìä –î–∞–Ω–Ω—ã–µ –∏–∑ API:", data);

                        searchResults.innerHTML = "";
                        if (!data.results || data.results.length === 0) {
                            searchResults.innerHTML = '<div class="list-group-item">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                        } else {
                            data.results.forEach(professor => {
                                const item = document.createElement("a");
                                item.href = `/professor/${professor.id}/`;
                                item.classList.add("list-group-item", "list-group-item-action");
                                item.innerHTML = `<img src="${professor.photo}" width="30" class="me-2">${professor.name} - ‚≠ê ${professor.avg_rating}`;
                                searchResults.appendChild(item);
                            });
                        }
                        searchResults.style.display = "block";
                    })
                    .catch(error => {
                        console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:", error);
                    });
            });

            document.addEventListener("click", function(event) {
                if (!searchResults.contains(event.target) && event.target !== searchInput) {
                    searchResults.style.display = "none";
                }
            });
        });
    </script>




{% endblock %}
